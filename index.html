<!DOCTYPE html>
<html>
	<head>
		<title>SF Dispatch Data</title>
		<link rel='stylesheet' href='stylesheets/style.css' />
		<link rel='stylesheet' href='stylesheets/bootstrap.min.css' />
		<link rel='stylesheet' href='stylesheets/font-awesome.min.css' />

		<!-- Load c3.css -->
		<link href="stylesheets/c3.css" rel="stylesheet" type="text/css">

		<!-- Load d3.js and c3.js -->
		<script src="javascripts/d3.v3.min.js" charset="utf-8"></script>
		<script src="javascripts/c3.min.js"></script>

		<!-- Load papaparse.js -->
		<script src="javascripts/papaparse.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <style>
    h1 {
      padding-left:100px;
    }
    h4 {
      padding-left:100px;
    }
    h5 {
      font-size: 15px;
    }
    p {
      font-size: 13px;
      padding-left:120px;
      padding-right:80px;
    }
    </style>
  	</head>
  	<body>

      <div class="container">
        <h2 id="text-center"> Enter Location:</h2>
        <form id="location-form">
          <input type="text" id="location-input" class="form-control form-control-lg">
          <br>
          <button type="submit" class="btn btn-primary btn-block">Submit</button>
        </form>
        <div class="card-block" id="formatted-address"></div>
        <div class="card=block" id="address-components"></div>
        <div class="card=block" id="geometry"></div>
      </div>

    <script>
      // Call Geocode
      //geocode();

      // Get Location Form
      var locationForm = document.getElementById('location-form');

      // Listen for submit
      locationForm.addEventListener('submit', geocode);

      function geocode(e) {
        // Prevent actual submit
        e.preventDefault();

        var location = document.getElementById('location-input').value;
        axios.get('https://maps.googleapis.com/maps/api/geocode/json', {
          params: {
            address: location,
            key: 'AIzaSyD2SeaGAyCdSFS3xsdSAIYd2TRrQS6f9AM'
          }
        })
        .then(function(response){
          // Log full response
          console.log(response);

          // Formatted Address
          var formattedAddress = response.data.results[0].formatted_address;
          var formattedAddressOutput = `
            <ul class = "list-group">
              <li class="list-group-item">${formattedAddress}</li>
            </ul>
          `;

          // Address Components
          var addressComponents = response.data.results[0].address_components;
          var addressComponentsOutput = '<ul class="list-group">';
          for (var i = 0; i < addressComponents.length; i++) {
            addressComponentsOutput += `
              <li class="list-group-item"><strong>${addressComponents[i].types[0]}</strong>: ${addressComponents[i].long_name}</li>
            `;
          }
          addressComponentsOutput += '</ul>';

          // Geometry
          var lat = response.data.results[0].geometry.location.lat;
          var lng = response.data.results[0].geometry.location.lng;
          var geometryOutput = `
            <ul class = "list-group">
              <li class="list-group-item"><strong>Latitude:</strong> ${lat}</li>
              <li class="list-group-item"><strong>Longitude:</strong> ${lng}</li>
            </ul>
          `;

          // Output to app
          document.getElementById('formatted-address').innerHTML = formattedAddressOutput;
          document.getElementById('address-components').innerHTML = addressComponentsOutput;
          document.getElementById('geometry').innerHTML = geometryOutput;
        })
        .catch(function(error){
          console.log(error);
        });
      }
    </script>
      <br><br>
      <h1>Predicting Emergency Calls</h1>
      <h4>Data from San Francisco Police Dispatch. January 2018</h4>
      <h4>Raymond Pang</h4>

      <br><br>
      <center><h5>Different Types of Dispatch per Zipcode</h5></center>
      <div class="container">
        <div id="chart"></div>
      </div>
      <br>
      <p>Zipcodes 94102 and 94103 have a significantly more amount of dispatch calls than all other zipcodes. Neighborhoods in these zipcodes include South of Market and Hayes Valley. These are heavily populated areas in downtown SF, which is a possible explanation for the high volume of dispatches.<br><br>Of all the dispatches, most are deemed potentially life threatening, with very few fires but a solid amount of non life threatening and alarm dispatches.<br><br>Zipcodes 94104, 94129, and 94130 have very few dispatches to. These neighborhoods are the financial district, Presidio, and Treasure Island. Presidio is a big park with a golf course, trails, and overlooks. Treasure Island is a tourist attraction with 2,000 people living there. It is realistic to understand why so few dispatches are in these two areas.</p>

      <br><br><br>
      <center><h5>Number of Recieved Calls Every Hour</h5></center>
      <div class="container">
        <div id="chart2"></div>
      </div>
      <p>From midnight to 8am, there is the lowest volume of calls. More specifically, the least calls occur from 3am to 5am. After 5am, the volume increases and peaks from noon to 4pm. Or, late nights and evenings are less busy compared to daytime hours.</p>

      <br><br>
      <center><h5>Average Time for Dispatch Arrival per Zipcode</h5></center>
      <div class="container">
        <div id="chart3"></div>
      </div>
      <p>Most zipcodes take 7 to 9 minutes for a dispatch to arrive from the moment someone makes a 911 call. Zipcode 94129 has a noticeably long average dispatch time, 13.34 minutes. 94129 is Presidio. This is understandable because Presidio has many trails and is a big park. Zipcode 94131 also has a noticeably long average dispatch time, 11.03 minutes. 94131 John McLaren Park but has a decent amount of residential houses.</p>
      <script src="javascripts/create-graph.js"></script>
  	</body>
</html>
